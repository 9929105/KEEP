{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}{{ repo.owner }} / {{ repo.name }}{% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css" href='{% static "css/leaflet.css" %}'>
<link rel="stylesheet" type="text/css" href='{% static "css/MarkerCluster.css" %}'>
<link rel="stylesheet" type="text/css" href='{% static "css/MarkerCluster.Default.css" %}'>
{% endblock %}

{% block js %}
<script type='text/javascript'>
	document.repo = {{repo_json|safe}};
	document.initial_data = {{data|safe}};
</script>
<script src='{% static 'js/vendor/requirejs.js' %}'></script>
<script type='text/javascript'>
	require([ '{% static "js/common.js" %}' ], function (common) {
		require.config({
			baseUrl: '{% static "js/vendor" %}'
		});

		require( [ 'app/viz/main' ] )
	});
</script>
{% endblock %}

{% block outerspace %}
<div id='viz-chrome'>
	<div class='container container-padded'>
		<div id='repo-privacy' class='one columns'>
			<div>
				{% if repo.is_public %}
					<i class='icon-unlock'></i>
				{% else %}
					<i class='icon-lock'></i>
				{% endif %}
			</div>
		</div>
		<div id='repo-meta' class='ten columns'>
			<h4>{{ repo.owner }} / {{ repo.name }}</h4>
			<div>
				{% if repo.description %}
					{{ repo.description }}
				{% else %}
					<em>No diary description available</em>
				{% endif %}
			</div>
		</div>
		<div id='repo-actions' class='five columns'>
			<ul class='nav-list nav-inline'>
				<li>
					<a class='btn' href='#'>
						<i class='icon-group'></i>&nbsp;Share
					</a>
				</li>
				<li>
					<a class='btn btn-primary' href='/api/v1/data/{{ repo.mongo_id }}?format=csv'>
						<i class='icon-download'></i>&nbsp;Download
					</a>
				</li>
			</ul>
		</div>
	</div>
	<div class='container'>
		<div class='sixteen columns'>
			<ul id='viz-options' class='nav-list nav-inline'>
				<li id='raw_btn' class='active' data-type='raw'>
					<a href='#'>
						<i class='icon-list'></i>&nbsp;Raw
					</a>
				</li>
				<li id='map_btn' data-type='map'>
					<a href='#'>
						<i class='icon-map-marker'></i>&nbsp;Map
					</a>
				</li>
				<li id='line_btn' data-type='line'>
					<a href='#'>
						<i class='icon-signal'></i>&nbsp;Analytics
					</a>
				</li>
				{% if 'delete_repository' in permissions %}
				<li data-type='settings'>
					<a href='#' data-type='settings'>
						<i class='icon-cog'></i>&nbsp;Settings
					</a>
				</li>
				{% endif %}
			</ul>
		</div>
	</div>
</div>
<div id='viz-data'>
	<!-- Raw data list -->
	<div class='viz viz-active' id='raw-viz'>
		<div id='fixed-header'>
			<table class='table fixed'><tr></tr></table>
		</div>
		<div id='raw_list' class='sixteen columns active'>
			<table id='raw_table' class='table fixed'><tbody></tbody></table>
		</div>
	</div>

	<!-- Geospatial view of our data ( if any geopoints exist within the dataset ). -->
	<div class='viz' id='map-viz'>
		<div class='sixteen columns' id='map'></div>
	</div>

	<!-- Time series analysis -->
	<div class='viz container' id='analytics-viz'>
		<div class='four columns'>
			<h4>Y-Axis Options</h4>
			<div id='yaxis_options'></div>
		</div>
		<div class='twelve columns' id='line'></div>
	</div>

	<!-- Repository settings -->
	{% if 'delete_repository' in permissions %}
	<div class='viz container' id='settings-viz'>
		<div class='sixteen columns'>

			<h4>Administration</h4>

			<div class='row'>
				<div class='six columns'>
					<strong>Edit this data repository</strong>
				</div>
				<div class='ten columns' style='text-align:right;'>
					<a href='{% url "repo_edit" repo_id=repo.mongo_id %}' class='btn btn-medium'>
						Edit Repository
					</a>
				</div>
			</div>

			<div class='row'>
				<div class='six columns'>
					<strong>Delete this data repository</strong>
					<div class='help-block'>
						Once you delete a repository, <strong>ALL</strong> data will
						be removed.
					</div>
				</div>
				<div class='ten columns' style='text-align:right;'>
					<a href='{% url "repo_delete" repo_id=repo.mongo_id %}' class='btn btn-danger'>
						<i class='icon-trash'></i> Delete Repository
					</a>
				</div>
			</div>

			<h4>Diary Backup</h4>

			<div class='row'>
				<div class='sixteen columns'>
					<div>
						<a class='btn' href='/api/v1/repos/{{ repo.mongo_id }}/?format=json'>
							Download Diary as JSON
						</a>
					</div>
					<div style='margin-top:16px;'>
						<a class='btn' href='/api/v1/repos/{{ repo.mongo_id }}/?format=xform'>
							Download Diary as XForm
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	{% endif %}
</div>
{% endblock %}
