(function($,_,Backbone){var _interpolateBackup=_.templateSettings;_.templateSettings={interpolate:/\{\{(.+?)\}\}/g,evaluate:/<%([\s\S]+?)%>/g};var template=_.template('    <% if (title) { %>      <div class="modal-header">        <% if (allowCancel) { %>          <a class="close">Ã—</a>        <% } %>        <h3>{{title}}</h3>      </div>    <% } %>    <div class="modal-body">{{content}}</div>    <div class="modal-footer">      <% if (allowCancel) { %>        <% if (cancelText) { %>          <a href="#" class="btn cancel">{{cancelText}}</a>        <% } %>      <% } %>      <a href="#" class="btn ok btn-primary">{{okText}}</a>    </div>  ');_.templateSettings=_interpolateBackup;var Modal=Backbone.View.extend({className:"modal",events:{"click .close":function(event){event.preventDefault(),this.trigger("cancel")},"click .cancel":function(event){event.preventDefault(),this.trigger("cancel")},"click .ok":function(event){event.preventDefault(),this.trigger("ok"),this.close()}},initialize:function(options){this.options=_.extend({title:null,okText:"OK",cancelText:"Cancel",allowCancel:!0,escape:!0,animate:!1,template:template},options)},render:function(){var $el=this.$el,options=this.options,content=options.content;$el.html(options.template(options));var $content=this.$content=$el.find(".modal-body");return content.$el&&$el.find(".modal-body").html(content.render().$el),options.animate&&$el.addClass("fade"),this.isRendered=!0,this},open:function(cb){this.isRendered||this.render();var self=this,$el=this.$el;$el.modal({keyboard:this.options.allowCancel,backdrop:this.options.allowCancel?!0:"static"}),$el.one("shown",function(){$el.find(".btn.ok").focus(),self.trigger("shown")});var numModals=Modal.count,$backdrop=$(".modal-backdrop:eq("+numModals+")"),backdropIndex=$backdrop.css("z-index"),elIndex=$backdrop.css("z-index");return $backdrop.css("z-index",backdropIndex+numModals),this.$el.css("z-index",elIndex+numModals),this.options.allowCancel&&($backdrop.one("click",function(){self.trigger("cancel")}),$(document).one("keyup.dismiss.modal",function(e){e.which==27&&self.trigger("cancel")})),this.on("cancel",function(){self.close()}),Modal.count++,cb&&self.on("ok",cb),this},close:function(){var self=this,$el=this.$el;if(this._preventClose){this._preventClose=!1;return}$el.modal("hide"),$el.one("hidden",function(){self.remove(),self.trigger("hidden")}),Modal.count--},preventClose:function(){this._preventClose=!0}},{count:0});typeof require=="function"&&typeof module!="undefined"&&exports&&(module.exports=Modal);if(typeof define=="function"&&define.amd)return define(function(){Backbone.BootstrapModal=Modal});Backbone.BootstrapModal=Modal})(jQuery,_,Backbone)